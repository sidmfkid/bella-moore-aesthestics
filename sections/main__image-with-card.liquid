

<div class="image-with-card">
    <div class="image-with-card__image-container">
        <img id="{{section.id}}-image"
            alt=""
            class="image-with-card__image"
            height="933"
            src="https://cdn.shopify.com/s/files/1/0581/1680/0605/files/image-with-card.jpg?v=1652923902"
            width="1500">
    </div>
    <div class="image-with-card__card">
        <h2 id="{{section.id}}-heading" class="image-with-card__heading">Cool Sculpting</h2>
        <p id="{{section.id}}-para" class="image-with-card__para">CoolSculptingÂ® is non-invasive body contouring at its finest, delivering
            beautiful results by harnessing advanced cryolipolysis technique. Experience this incredible treatment at
            the best med spa in Henderson, Las Vegas, Nashville, and Greenville.</p>
        <div class="image-with-card__button">
            <a id="{{section.id}}-link" class="btn btn__primary--md" href="">Get Started</a>
        </div>
    </div>
    <div class="image-with-card__tabs">
        {% for block in section.blocks %}

            <div {{ block.shopify_attributes }} class="image-with-card__tab-wrapper">
                <button id="cardTab" class="image-with-card__tab{% if forloop.index == 1 %}--active{% endif %} block_{{ forloop.index }}">{{ block.settings.heading }}</button>
            </div>
        {% endfor %}

    </div>
</div>
<script>
let cards = []
{% for block in section.blocks %}
  cards.push({
    id: "block_{{- forloop.index -}}",
    heading: "{{ block.settings.heading }}",
    para: "{{ block.settings.para }}",
    buttonText: "{{ block.settings.button__text }}",
    buttonLink: "{{ block.settings.button__link }}",
    image: "{{ block.settings.image | image_url }}"
  })
{% endfor %}
// console.log(cards)

const tabButtons = document.querySelectorAll('#cardTab');

tabButtons.forEach(btn => {
    btn.addEventListener("click", handleTabClick.bind(this))
});

function handleTabClick(e) {
    const headingEl = document.getElementById('{{section.id}}-heading');
    const paraEl = document.getElementById('{{section.id}}-para');
    const imageEl = document.getElementById('{{section.id}}-image');
    const linkEl = document.getElementById('{{section.id}}-link');
    const blockNum = e.target.classList[1]
    e.preventDefault();
    if (!e.target.classList.contains("image-with-card__tab--active")) {
        tabButtons.forEach(btn => {
            btn.classList.contains("image-with-card__tab--active") ? btn.classList.replace("image-with-card__tab--active", "image-with-card__tab") : btn.classList.replace("image-with-card__tab", "image-with-card__tab");
        });
        e.target.classList.replace("image-with-card__tab", "image-with-card__tab--active")
    }
    const selectedTab = cards.filter(card => card.id === blockNum)

    headingEl.textContent = selectedTab[0].heading;
    paraEl.textContent = selectedTab[0].para;
    imageEl.src = selectedTab[0].image;
    linkEl.textContent = selectedTab[0].buttonText;
    linkEl.href = selectedTab[0].buttonLink;


    // console.log(blockNum, selectedTab)
}
</script>


{% schema %}
{
"name": "main__image-with-card",
"settings": [
],
"max_blocks": 4,
"blocks": [
    {
       "name": "Tab",
       "type": "tab",
      "settings": [
          {
             "type": "text",
             "id": "heading",
             "label": "Heading"
          },
          {
             "type": "textarea",
             "id": "para",
             "label": "Paragraph"
          },
          {
            "type": "text",
            "id": "button__text",
            "label": "Button Text"
         },
         {
            "type": "url",
            "id": "button__link",
            "label": "Button Link"
         },
          {
             "type": "image_picker",
             "id": "image",
             "label": "Background Image",
             "info": "1500 x 933px recommended"
          }
      ]
    }
]
} {% endschema %}